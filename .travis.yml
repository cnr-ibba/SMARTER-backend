
os: linux
arch:
  - ppc64le
services:
  - docker
branches:
  only:
  - master
  - devel
# https://docs.travis-ci.com/user/docker/#using-docker-compose
# https://docs.docker.com/compose/install/#alternative-install-options
# https://docs.docker.com/compose/install/#install-as-a-container
before_install:
  - sudo curl -L --fail https://github.com/docker/compose/releases/download/1.29.2/run.sh -o /usr/local/bin/docker-compose
  - sudo chmod +x /usr/local/bin/docker-compose
install:
  - env | grep 'MONGODB' >> .env
  - docker-compose pull
  - docker-compose build
  - docker-compose up -d mongo
  - docker-compose run --no-deps --rm uwsgi sh -c 'chgrp -R www-data .'
  - docker-compose ps
script:
  - docker-compose run --no-deps --rm uwsgi sh -c 'coverage run --source='.' -m py.test && flake8'
# after_script:
#   - docker-compose run --rm uwsgi coveralls
#   - docker-compose run --rm uwsgi ocular
env:
  global:
  - DEBUG=False
  - MONGODB_ROOT_USER=root
  - MONGODB_ROOT_PASS=password1
  - MONGODB_SMARTER_USER=smarter
  - MONGODB_SMARTER_PASS=password2
  - DOCKER_COMPOSE_VERSION=1.27.4
